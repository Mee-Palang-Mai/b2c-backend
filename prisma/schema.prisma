generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//
// ========================= USER =========================
//
model User {
  empId       String      @id @default(uuid()) @map("emp_id")
  empNo       String   @map("emp_no")
  username    String   @map("username")
  password    String?  @map("password")
  name        String   @map("emp_name")
  nickName    String?  @map("nick_name")
  cognitoSub  String   @map("cognito_sub")
  registNo    String?  @map("regist_no")
  phoneNumber String?  @map("phone_number")
  email       String?  @map("email")
  empLevel    String?  @map("emp_level")
  teamId      String?     @map("team_id")
  workStart   DateTime @map("work_start_date")
  workStatus  String   @map("work_status")
  createAt    DateTime @default(now()) @map("created_at")
  updateAt    DateTime @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  team             Team?              @relation(fields: [teamId], references: [teamId])
  loginout         Loginout?
  attendences      Attendence[]
  extraPayRequests ExtraPayRequest[]
  deductRequests   DeductRequest[]
  payrolls         Payroll[]
  leaveBalances    LeaveBalance[]
  leaveRequests    LeaveRequest[]

  @@map("User")
}

//
// ========================= TEAM =========================
//
model Team {
  teamId    String      @id @default(uuid()) @map("team_id")
  name      String   @map("name")
  createAt  DateTime @default(now()) @map("created_at")
  updateAt  DateTime @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  users User[]

  @@map("Team")
}

//
// ========================= LOGINOUT =========================
//
model Loginout {
  transactionId String      @id @map("transaction_id")
  empId         String      @unique @map("emp_id")
  status        String   @map("status")
  timestamp     DateTime @map("timestamp")

  user User @relation(fields: [empId], references: [empId])

  @@map("Loginout")
}

//
// ========================= ATTENDENCE =========================
//
model Attendence {
  attendenceId       String   @id @default(uuid()) @map("attendence_id")
  empId        String   @map("emp_id")
  placeId      String   @map("place_id")
  checkInLatitude  Float    @map("check_in_latitude")
  checkInlongitude Float    @map("check_in_longitude")
  checkInDatetime  DateTime @map("check_in_datetime")
  checkOutlatitude Float?   @map("check_out_latitude")
  checkOutlongitude Float?  @map("check_out_longitude")
  checkOutDatetime DateTime? @map("check_out_datetime")
  status           String   @map("status")
  isOt             Boolean  @map("is_ot")
  createAt         DateTime @default(now()) @map("created_at")
  updateAt         DateTime @updatedAt @map("updated_at")
  deletedAt        DateTime? @map("deleted_at")

  user User   @relation(fields: [empId], references: [empId])
  place Place @relation(fields: [placeId], references: [placeId])

  ot         OT[]
  otRequests OTRequest[]

  @@map("Attendence")
}

//
// ========================= OT =========================
//
model OT {
  otId          String   @id @map("ot_id")
  attendenceId  String   @map("attendence_id")
  startDateTime DateTime @map("start_datetime")
  endDateTime   DateTime @map("end_datetime")

  attendence Attendence @relation(fields: [attendenceId], references: [attendenceId])

  @@map("OT")
}

//
// ========================= OT REQUEST =========================
//
model OTRequest {
  requestId     String   @id @map("request_id")
  attendenceId  String   @map("attendence_id")
  status        String   @map("status")
  note          String   @map("note")
  approvalBy    String?  @map("approval_by")
  createAt      DateTime @map("created_at")
  updateAt      DateTime @map("updated_at")
  deletedAt     DateTime? @map("deleted_at")

  attendence Attendence @relation(fields: [attendenceId], references: [attendenceId])

  @@map("OT Request")
}

//
// ========================= PLACE =========================
//
model Place {
  placeId    String   @id @map("place_id")
  placeName  String   @map("place_name")
  placeType  String   @map("place_type")
  latitude   Float    @map("latitude")
  longitude  Float    @map("longitude")
  createAt   DateTime @map("created_at")
  updateAt   DateTime @map("updated_at")
  deletedAt  DateTime? @map("deleted_at")

  attendences Attendence[]

  @@map("Place")
}

//
// ========================= PAYROLL =========================
//
model Payroll {
  payrollId    String   @id @map("payroll_id")
  empId        String      @map("emp_id")
  salary       Float?   @map("salary")
  incentivePay Float?   @map("incentive_pay")
  extraTotal   Float?   @map("extra_total")
  deductTotal  Float?   @map("deduct_total")
  totalPay     Float?   @map("total_pay")
  payrollDate  DateTime @map("payroll_date")
  createDate   DateTime @map("create_Date")
  updateDate   DateTime @map("update_Date")

  user User @relation(fields: [empId], references: [empId])

  @@map("Payroll")
}

//
// ========================= EXTRA PAY =========================
//
model ExtraPayRequest {
  requestId     String   @id @map("request_id")
  empId         String      @map("emp_id")
  extraTypeId   String   @map("extra_type_id")
  status        String   @map("status")
  note          String   @map("note")
  approvalBy    String?  @map("approval_by")
  startDateTime DateTime @map("start_datetime")
  endDateTime   DateTime @map("end_datetime")
  createAt      DateTime @map("created_at")
  updateAt      DateTime @map("updated_at")
  deletedAt     DateTime @map("deleted_at")

  user        User        @relation(fields: [empId], references: [empId])
  extraPayType ExtraPayType @relation(fields: [extraTypeId], references: [extraTypeId])
  totals      ExtraPayTotal[]

  @@map("Extra pay Request")
}

model ExtraPayTotal {
  id        String   @id @map("id")
  requestId String   @map("request_id")
  amount    Float?   @map("extra_pay")
  createAt  DateTime @map("created_at")
  updateAt  DateTime @map("updated_at")

  request ExtraPayRequest @relation(fields: [requestId], references: [requestId])

  @@map("Extra pay Total")
}

model ExtraPayType {
  extraTypeId String   @id @map("extra_type_id")
  typeName    String  @map("type_name")
  payRate     String? @map("pay_rate")
  rateType    String? @map("rate_type")

  requests ExtraPayRequest[]

  @@map("Extra pay Type")
}

//
// ========================= DEDUCT =========================
//
model DeductRequest {
  requestId    String   @id @map("request_id")
  empId        String      @map("emp_id")
  deductTypeId String   @map("deduct_type_id")
  status       String   @map("status")
  note         String   @map("note")
  approvalBy   String?  @map("approval_by")
  createAt     DateTime @map("created_at")
  updateAt     DateTime @map("updated_at")
  deletedAt    DateTime? @map("deleted_At")

  user       User       @relation(fields: [empId], references: [empId])
  deductType DeductType @relation(fields: [deductTypeId], references: [deductTypeId])
  totals     DeductTotal[]

  @@map("Deduct Request")
}

model DeductTotal {
  id        String   @id @map("id")
  requestId String   @map("request_id")
  amount    Float?   @map("deduct_total")
  createAt  DateTime @map("created_at")
  updateAt  DateTime @map("updated_at")

  request DeductRequest @relation(fields: [requestId], references: [requestId])

  @@map("Deduct Total")
}

model DeductType {
  deductTypeId String   @id @map("deduct_type_id")
  typeName     String  @map("type_name")
  deductRate   Float?  @map("deduct_rate")
  rateType     String? @map("rate_type")

  requests DeductRequest[]

  @@map("Deduct Type")
}

//
// ========================= LEAVE =========================
//
model LeaveType {
  leaveTypeId String   @id @map("leave_type_id")
  typeName    String   @map("type_name")

  leaveRequests LeaveRequest[]
  leaveBalances LeaveBalance[]

  @@map("Leave Type")
}

model LeaveBalance {
  empId       String  @map("emp_id")
  leaveTypeId String  @map("leave_type_id")
  leaveCount  Int? @map("leave_count")
  leaveBalance Int? @map("leave_balance")

  leaveType LeaveType @relation(fields: [leaveTypeId], references: [leaveTypeId])
  user      User      @relation(fields: [empId], references: [empId])

  @@id([empId, leaveTypeId])
  @@map("Leave Balance")
}

model LeaveRequest {
  requestId     String   @id @map("request_id")
  empId         String      @map("emp_id")
  leaveTypeId   String   @map("leave_type_id")
  status        String   @map("status")
  note          String   @map("note")
  leaveCount    Int?     @map("leave_count")
  approvalBy    String?  @map("approval_by")
  startDateTime DateTime @map("start_datetime")
  endDateTime   DateTime @map("end_datetime")
  createAt      DateTime @map("created_at")
  updateAt      DateTime @map("updated_at")
  deletedAt     DateTime @map("deleted_at")

  leaveType LeaveType @relation(fields: [leaveTypeId], references: [leaveTypeId])
  user      User      @relation(fields: [empId], references: [empId])

  @@map("Leave Request")
}

enum UserRole {
  ADMIN
  SUPERVISOR
  EMPLOYEE
}
